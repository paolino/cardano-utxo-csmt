{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Cardano UTxO CSMT","text":"<p>A service that maintains a Compact Sparse Merkle Tree over Cardano's UTxO set, enabling efficient inclusion proofs.</p>"},{"location":"#features","title":"Features","text":"<ul> <li>Real-time Sync: Follows the Cardano blockchain via node-to-node protocol</li> <li>Merkle Proofs: Generate cryptographic inclusion proofs for any UTxO</li> <li>Rollback Handling: Gracefully handles chain reorganizations</li> <li>REST API: Simple HTTP interface for queries and proofs</li> </ul>"},{"location":"#presentation","title":"Presentation","text":"<p>Controls: Arrow keys / Space (navigate) | F (fullscreen) | Esc (overview)</p> <p>Open fullscreen presentation</p>"},{"location":"#how-it-works","title":"How It Works","text":"<p>The service connects to a Cardano node and maintains:</p> <ol> <li>UTxO Set: Current unspent transaction outputs</li> <li>CSMT: A Merkle tree with path compression for efficient proofs</li> <li>Rollback History: State snapshots for handling chain reorgs</li> </ol> <p>Each block updates the tree, producing a new Merkle root that commits to the entire UTxO set state.</p>"},{"location":"#use-cases","title":"Use Cases","text":"<ul> <li>Light Clients: Verify UTxO existence without downloading the full chain</li> <li>Bridges: Prove UTxO state to external systems</li> <li>Auditing: Cryptographic proof of UTxO set at any point</li> </ul>"},{"location":"#project-status","title":"Project Status","text":"<ul> <li>[x] Chain synchronization via node-to-node protocol</li> <li>[x] UTxO set tracking with RocksDB persistence</li> <li>[x] CSMT maintenance with Merkle root computation</li> <li>[x] HTTP API with Swagger documentation</li> <li>[x] Merkle roots endpoint</li> <li>[x] Inclusion proofs endpoint</li> <li>[ ] Bootstrap without mithril</li> <li>[ ] Exclusion proofs</li> <li>[ ] Address completeness proofs</li> </ul>"},{"location":"#links","title":"Links","text":"<ul> <li>GitHub Repository</li> <li>API Documentation</li> <li>Architecture Overview</li> </ul>"},{"location":"architecture/","title":"Architecture","text":"<p>This document describes the high-level architecture of the Cardano UTxO CSMT service.</p>"},{"location":"architecture/#overview","title":"Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Cardano Node   \u2502     \u2502           UTxO CSMT Service              \u2502\n\u2502                 \u2502     \u2502                                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502     \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 ChainSync \u2502\u25c4\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2524 ChainSync   \u2502\u2500\u2500\u2500\u25ba\u2502                 \u2502  \u2502\n\u2502  \u2502  Server   \u2502  \u2502     \u2502  \u2502 Client      \u2502    \u2502                 \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502     \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502    Database     \u2502  \u2502\n\u2502                 \u2502     \u2502                     \u2502    (RocksDB)    \u2502  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502     \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502                 \u2502  \u2502\n\u2502  \u2502BlockFetch \u2502\u25c4\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2524 BlockFetch  \u2502\u2500\u2500\u2500\u25ba\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u2502\n\u2502  \u2502  Server   \u2502  \u2502     \u2502  \u2502 Client      \u2502    \u2502  \u2502   UTxOs   \u2502  \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502     \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524  \u2502  \u2502\n\u2502                 \u2502     \u2502                     \u2502  \u2502   CSMT    \u2502  \u2502  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502                     \u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524  \u2502  \u2502\n                        \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502  \u2502 Rollback  \u2502  \u2502  \u2502\n                        \u2502  \u2502 HTTP Server \u2502    \u2502  \u2502  Points   \u2502  \u2502  \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502  \u2502             \u2502    \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2502\n\u2502   HTTP Client   \u2502\u25c4\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2524 /metrics    \u2502    \u2502                 \u2502  \u2502\n\u2502                 \u2502     \u2502  \u2502 /proof/:id  \u2502\u25c4\u2500\u2500\u2500\u2524                 \u2502  \u2502\n\u2502                 \u2502     \u2502  \u2502 /merkle-... \u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                         \u2502\n                        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/#components","title":"Components","text":""},{"location":"architecture/#chain-synchronization","title":"Chain Synchronization","text":"<p>The service connects to a Cardano node using the node-to-node protocol:</p> <ul> <li>ChainSync Client: Follows the chain tip, receiving block headers</li> <li>BlockFetch Client: Retrieves full block data for processing</li> <li>KeepAlive: Maintains the connection</li> </ul> <p>Headers are queued and blocks are fetched in batches for efficiency.</p>"},{"location":"architecture/#utxo-processing","title":"UTxO Processing","text":"<p>For each block, the service extracts UTxO changes:</p> <ul> <li>Spends: Inputs consumed by transactions (deletions)</li> <li>Creates: Outputs produced by transactions (insertions)</li> </ul> <p>UTxO references are CBOR-encoded for consistent storage across all eras (Byron through Conway).</p>"},{"location":"architecture/#compact-sparse-merkle-tree-csmt","title":"Compact Sparse Merkle Tree (CSMT)","text":"<p>The CSMT provides efficient membership proofs:</p> <ul> <li>Insertion: O(log n) with path compression</li> <li>Deletion: O(log n) with automatic compaction</li> <li>Proof Generation: O(log n) inclusion proofs</li> </ul> <p>The Merkle root changes with each block, providing a cryptographic commitment to the UTxO set state.</p>"},{"location":"architecture/#database-rocksdb","title":"Database (RocksDB)","text":"<p>Three column families store different data:</p> Column Key Value UTxOs TxIn (CBOR) TxOut (CBOR) CSMT Path Hash + Jump Rollback Points Slot Changes for rollback <p>Rollback points enable chain reorganization handling without full recomputation.</p>"},{"location":"architecture/#http-api","title":"HTTP API","text":"<p>The REST API provides:</p> <ul> <li><code>GET /metrics</code> - Sync progress and performance metrics</li> <li><code>GET /merkle-roots</code> - Historical merkle roots by slot</li> <li><code>GET /proof/:txId/:txIx</code> - Inclusion proof for a UTxO</li> </ul>"},{"location":"architecture/#data-flow","title":"Data Flow","text":"<ol> <li>Block Arrival: ChainSync receives header, BlockFetch retrieves block</li> <li>UTxO Extraction: Parse transactions, extract inputs/outputs</li> <li>Database Update: Apply changes atomically (deletes + inserts)</li> <li>CSMT Update: Update Merkle tree, compute new root</li> <li>Finality Tracking: Move finality point, prune old rollback data</li> </ol>"},{"location":"architecture/#rollback-handling","title":"Rollback Handling","text":"<p>When the node reports a rollback:</p> <ol> <li>Find the rollback point in stored history</li> <li>Apply inverse operations to restore previous state</li> <li>Resume following from the new chain tip</li> </ol> <p>If rollback exceeds stored history (truncation), the service restarts sync from genesis.</p>"},{"location":"architecture/#bootstrapping","title":"Bootstrapping","text":"<p>Two approaches are available for initial UTxO set population:</p>"},{"location":"architecture/#mithril-bootstrap","title":"Mithril Bootstrap","text":"<p>Downloads a certified UTxO snapshot from Mithril aggregators, then syncs headers to reach the snapshot slot before continuing normal block processing.</p> <p>See Mithril Bootstrap for details.</p>"},{"location":"architecture/#direct-chain-sync-planned","title":"Direct Chain Sync (Planned)","text":"<p>For environments where Mithril is not available, a direct chain sync approach is planned with two key optimizations:</p> <ol> <li>Era projection: Project all TxOut to Conway era before storage</li> <li>Change reduction: Reduce UTxO changes inline as ChainSync writes to the buffer,    eliminating transient UTxOs that are created and consumed during sync</li> <li>Double buffering: ChainSync and CSMT work concurrently on separate buffers</li> </ol> <pre><code>ChainSync \u2500\u2500reduce+write\u2500\u2500\u25ba Buffer A              CSMT idle\n                               \u2502\n                             [swap]\n                               \u2502\nChainSync \u2500\u2500reduce+write\u2500\u2500\u25ba Buffer B    \u25c4\u2500\u2500\u2500\u2500 CSMT applies Buffer A\n                               \u2502\n                             [swap]\n                               \u2502\nChainSync \u2500\u2500reduce+write\u2500\u2500\u25ba Buffer A    \u25c4\u2500\u2500\u2500\u2500 CSMT applies Buffer B\n</code></pre> <p>Reduction happens inline during ChainSync writes:</p> <ul> <li>Insert: add <code>TxIn \u2192 TxOut</code> to active buffer</li> <li>Delete: if <code>TxIn</code> exists in buffer, remove it (transient UTxO eliminated);   otherwise record as pending delete</li> </ul> <p>CSMT applies the already-reduced batch without additional processing.</p> <p>See issue #58 for details.</p>"},{"location":"getting-started/","title":"Getting Started","text":"<p>This guide covers installation, configuration and usage of the Cardano UTxO CSMT service.</p>"},{"location":"getting-started/#prerequisites","title":"Prerequisites","text":"<ul> <li>A trusted running Cardano node with secure node-to-node protocol access</li> <li>Network connectivity to the node's port (default: 3001)</li> </ul>"},{"location":"getting-started/#setup-environment-variables","title":"Setup Environment Variables","text":"<p>Mithril bootstrap requires environment variables for verification. Download and export them for your network:</p> PreprodPreviewMainnet <pre><code>export MITHRIL_AGGREGATOR_ENDPOINT=https://aggregator.release-preprod.api.mithril.network/aggregator\nexport MITHRIL_GENESIS_VERIFICATION_KEY=$(curl -s https://raw.githubusercontent.com/input-output-hk/mithril/main/mithril-infra/configuration/release-preprod/genesis.vkey)\nexport MITHRIL_ANCILLARY_VERIFICATION_KEY=$(curl -s https://raw.githubusercontent.com/input-output-hk/mithril/main/mithril-infra/configuration/release-preprod/ancillary.vkey)\n</code></pre> <pre><code>export MITHRIL_AGGREGATOR_ENDPOINT=https://aggregator.pre-release-preview.api.mithril.network/aggregator\nexport MITHRIL_GENESIS_VERIFICATION_KEY=$(curl -s https://raw.githubusercontent.com/input-output-hk/mithril/main/mithril-infra/configuration/pre-release-preview/genesis.vkey)\nexport MITHRIL_ANCILLARY_VERIFICATION_KEY=$(curl -s https://raw.githubusercontent.com/input-output-hk/mithril/main/mithril-infra/configuration/pre-release-preview/ancillary.vkey)\n</code></pre> <pre><code>export MITHRIL_AGGREGATOR_ENDPOINT=https://aggregator.release-mainnet.api.mithril.network/aggregator\nexport MITHRIL_GENESIS_VERIFICATION_KEY=$(curl -s https://raw.githubusercontent.com/input-output-hk/mithril/main/mithril-infra/configuration/release-mainnet/genesis.vkey)\nexport MITHRIL_ANCILLARY_VERIFICATION_KEY=$(curl -s https://raw.githubusercontent.com/input-output-hk/mithril/main/mithril-infra/configuration/release-mainnet/ancillary.vkey)\n</code></pre> <p>Source: Mithril Network Configurations</p>"},{"location":"getting-started/#installation","title":"Installation","text":""},{"location":"getting-started/#nix","title":"Nix","text":"<pre><code># Setup caching (recommended)\nnix shell nixpkgs#cachix -c cachix use paolino\n\n# Run on preprod with Mithril bootstrap\nnix run github:paolino/cardano-utxo-csmt -- \\\n  --network preprod \\\n  --mithril-bootstrap \\\n  --db-path /tmp/csmt-db \\\n  --api-port 8080\n</code></pre> <p>This will:</p> <ol> <li>Download the latest Mithril snapshot for preprod</li> <li>Verify the Ed25519 signature on the ancillary manifest</li> <li>Extract and import the UTxO set into the CSMT database</li> <li>Start chain sync from the snapshot slot</li> </ol>"},{"location":"getting-started/#configuration-options","title":"Configuration Options","text":"Option Description <code>--network</code> Network: <code>mainnet</code>, <code>preprod</code>, <code>preview</code> (default: mainnet) <code>--node-name</code> Override peer node hostname <code>--node-port</code> Override peer node port <code>--db-path</code> RocksDB database path (required) <code>--api-port</code> HTTP API port for REST endpoints <code>--api-docs-port</code> HTTP port for Swagger UI documentation <code>--mithril-bootstrap</code> Bootstrap from Mithril snapshot <code>--mithril-ancillary-verification-key</code> Ed25519 key for ancillary verification <code>--mithril-genesis-verification-key</code> Genesis key for mithril-client CLI <code>--mithril-aggregator-endpoint</code> Mithril aggregator URL <code>--mithril-skip-ancillary-verification</code> Skip Ed25519 verification (not recommended)"},{"location":"getting-started/#verifying-the-service","title":"Verifying the Service","text":"<p>Once running, check the service status:</p> <pre><code># Check readiness\ncurl http://localhost:8080/ready\n\n# Check metrics\ncurl http://localhost:8080/metrics\n\n# View API documentation\nopen http://localhost:8080/api-docs/swagger-ui\n</code></pre>"},{"location":"getting-started/#next-steps","title":"Next Steps","text":"<ul> <li>Mithril Bootstrap - Details on Mithril bootstrapping</li> <li>API Documentation - Explore the REST API</li> <li>Architecture - Understand how it works</li> </ul>"},{"location":"mithril-bootstrap/","title":"Mithril Bootstrap","text":"<p>Mithril enables fast bootstrapping of the Cardano UTxO CSMT database by downloading certified snapshots instead of syncing from genesis.</p>"},{"location":"mithril-bootstrap/#implementation-status","title":"Implementation Status","text":"Feature Status Notes Fetch snapshot metadata \u2705 Working All networks (mainnet, preprod, preview) HTTP download \u2705 Working Downloads ancillary data with ledger state Ed25519 ancillary verification \u2705 Working Verifies manifest signature for all networks Find ledger state files \u2705 Working Supports both old (.lstate) and new UTxO-HD formats CLI options \u2705 Working <code>--network</code>, <code>--mithril-bootstrap</code>, etc. UTxO extraction from ledger state \u2705 Working Streams MemPack-encoded (TxIn, TxOut) pairs from tvar file TxIn/TxOut decoding \u2705 Verified Decodes as Conway-era <code>TxIn</code> and <code>BabbageTxOut</code> CBOR re-encoding \u2705 Working Converts MemPack to CBOR for chain sync compatibility STM certificate verification \ud83d\udd2e Planned See FFI plan on <code>feature/mithril-stm-ffi-plan</code> branch"},{"location":"mithril-bootstrap/#overview","title":"Overview","text":"<p>Mithril bootstrapping:</p> <ol> <li>Downloads the latest certified snapshot from Mithril aggregators</li> <li>Extracts the UTxO set from the InMemory backing store (<code>tables/tvar</code>)</li> <li>Decodes MemPack to Conway-era types, re-encodes to CBOR for chain sync compatibility</li> <li>Streams into CSMT database using the standard import interface</li> </ol> <p>This provides a fast way to obtain UTxO set data without syncing from genesis.</p>"},{"location":"mithril-bootstrap/#bootstrap-time-estimates","title":"Bootstrap Time Estimates","text":"<p>Bootstrap time depends on three phases:</p> Phase Description Download Download snapshot from Mithril CDN (~400MB for preview) Extraction Extract and import UTxOs into CSMT database Header Sync Sync headers from genesis to Mithril slot (skip mode)"},{"location":"mithril-bootstrap/#estimated-times-by-network","title":"Estimated Times by Network","text":"Network UTxOs Slots Download Extraction Header Sync Total Preview ~2.9M ~103M ~5 min ~1 hour ~1.5 hours ~2.5 hours Preprod ~5M ~75M ~10 min ~2 hours ~1 hour ~3.5 hours Mainnet ~20M ~140M ~30 min ~8 hours ~2 hours ~10-12 hours <p>Notes:</p> <ul> <li>Times measured with a local cardano-node (same machine or LAN)</li> <li>Hardware: SSD storage, 100Mbps+ connection for Mithril download</li> <li>Extraction rate: ~800-1000 UTxOs/second</li> <li>Header sync rate: ~15,000-20,000 slots/second (depends on node proximity)</li> <li>Mainnet estimates are projections based on preview/preprod measurements</li> <li>Remote nodes will have slower header sync due to network latency</li> </ul>"},{"location":"mithril-bootstrap/#what-is-a-mithril-snapshot","title":"What Is a Mithril Snapshot?","text":"<p>A Mithril snapshot captures the ledger state at a slot deep in the immutable history of the Cardano blockchain.</p> <p>Key distinction:</p> <ul> <li>The snapshot is not the immutable DB (blocks) itself</li> <li>It is the ledger state (UTxO set, stake distribution, etc.) that results   from processing those blocks</li> <li>The slot is past the security parameter (k=2160 blocks), making it final</li> </ul> <p>This is what makes Mithril useful: you get the final state without replaying all the blocks from genesis.</p> <p>Trust model:</p> <p>The ledger state is cryptographically signed by Cardano stake pool operators using Mithril's STM (Stake-based Threshold Multi-signatures). Verifying the certificate chain proves the snapshot was produced correctly by the network.</p>"},{"location":"mithril-bootstrap/#usage","title":"Usage","text":"<p>Enable Mithril bootstrap with the <code>--mithril-bootstrap</code> flag:</p> <pre><code>cardano-utxo \\\n    --network preview \\\n    --mithril-bootstrap \\\n    --db-path /path/to/db\n</code></pre> <p>The <code>--network</code> option sets both the Cardano network (magic, default peer) and the Mithril network automatically.</p>"},{"location":"mithril-bootstrap/#environment-variables","title":"Environment Variables","text":"<p>Set up environment variables for your network before running:</p> PreprodPreviewMainnet <pre><code>export MITHRIL_AGGREGATOR_ENDPOINT=https://aggregator.release-preprod.api.mithril.network/aggregator\nexport MITHRIL_GENESIS_VERIFICATION_KEY=$(curl -s https://raw.githubusercontent.com/input-output-hk/mithril/main/mithril-infra/configuration/release-preprod/genesis.vkey)\nexport MITHRIL_ANCILLARY_VERIFICATION_KEY=$(curl -s https://raw.githubusercontent.com/input-output-hk/mithril/main/mithril-infra/configuration/release-preprod/ancillary.vkey)\n</code></pre> <pre><code>export MITHRIL_AGGREGATOR_ENDPOINT=https://aggregator.pre-release-preview.api.mithril.network/aggregator\nexport MITHRIL_GENESIS_VERIFICATION_KEY=$(curl -s https://raw.githubusercontent.com/input-output-hk/mithril/main/mithril-infra/configuration/pre-release-preview/genesis.vkey)\nexport MITHRIL_ANCILLARY_VERIFICATION_KEY=$(curl -s https://raw.githubusercontent.com/input-output-hk/mithril/main/mithril-infra/configuration/pre-release-preview/ancillary.vkey)\n</code></pre> <pre><code>export MITHRIL_AGGREGATOR_ENDPOINT=https://aggregator.release-mainnet.api.mithril.network/aggregator\nexport MITHRIL_GENESIS_VERIFICATION_KEY=$(curl -s https://raw.githubusercontent.com/input-output-hk/mithril/main/mithril-infra/configuration/release-mainnet/genesis.vkey)\nexport MITHRIL_ANCILLARY_VERIFICATION_KEY=$(curl -s https://raw.githubusercontent.com/input-output-hk/mithril/main/mithril-infra/configuration/release-mainnet/ancillary.vkey)\n</code></pre> <p>Source: Mithril Network Configurations</p> <p>Note: Preview and Preprod currently share the same ancillary verification key. Mainnet has a distinct key.</p>"},{"location":"mithril-bootstrap/#cli-options","title":"CLI Options","text":"Option Description Default <code>--network NETWORK</code> Network: <code>mainnet</code>, <code>preprod</code>, <code>preview</code> <code>mainnet</code> <code>--mithril-bootstrap</code> Enable Mithril bootstrapping <code>false</code> <code>--mithril-bootstrap-only</code> Exit after bootstrap (skip chain sync) <code>false</code> <code>--mithril-aggregator-endpoint URL</code> Override aggregator URL From env var <code>--mithril-genesis-verification-key KEY</code> Genesis verification key (JSON-hex) From env var <code>--mithril-ancillary-verification-key KEY</code> Ancillary verification key (JSON-hex) From env var <code>--mithril-download-dir DIR</code> Directory for downloads Temp directory <code>--mithril-skip-ancillary-verification</code> Skip Ed25519 verification (not recommended) <code>false</code> <p>Environment Variables:</p> Variable Description <code>MITHRIL_AGGREGATOR_ENDPOINT</code> Mithril aggregator URL <code>MITHRIL_GENESIS_VERIFICATION_KEY</code> Genesis verification key for mithril-client CLI (JSON-hex) <code>MITHRIL_ANCILLARY_VERIFICATION_KEY</code> Ed25519 verification key for ancillary files (JSON-hex)"},{"location":"mithril-bootstrap/#networks","title":"Networks","text":"Network Aggregator URL Ancillary Verification Mainnet <code>https://aggregator.release-mainnet.api.mithril.network/aggregator</code> \u2705 Ed25519 Preprod <code>https://aggregator.release-preprod.api.mithril.network/aggregator</code> \u2705 Ed25519 Preview <code>https://aggregator.pre-release-preview.api.mithril.network/aggregator</code> \u2705 Ed25519"},{"location":"mithril-bootstrap/#bootstrap-design","title":"Bootstrap Design","text":"<p>This section describes the complete bootstrap flow and the design decisions behind it.</p>"},{"location":"mithril-bootstrap/#bootstrap-phases","title":"Bootstrap Phases","text":"<p>The bootstrap process consists of five phases, tracked via the <code>/metrics</code> endpoint:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Downloading \u2502\u2500\u2500\u2500\u25b6\u2502 Counting \u2502\u2500\u2500\u2500\u25b6\u2502 Extracting \u2502\u2500\u2500\u2500\u25b6\u2502 Syncing Headers \u2502\u2500\u2500\u2500\u25b6\u2502 Synced \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> Phase Description Progress Tracking <code>downloading</code> Fetching Mithril snapshot from CDN <code>downloadedBytes</code> <code>counting</code> Counting UTxOs in snapshot <code>countingProgress</code> <code>extracting</code> Importing UTxOs into CSMT <code>extractionProgress</code> (current, total, rate, eta) <code>syncing_headers</code> Syncing headers to reach Mithril slot <code>headerSyncProgress</code> (currentSlot, targetSlot) <code>synced</code> Ready to serve queries <code>ready: true</code>"},{"location":"mithril-bootstrap/#skip-mode-header-only-sync","title":"Skip Mode (Header-Only Sync)","text":"<p>After Mithril import, the database contains UTxOs at slot X (the Mithril snapshot slot). We cannot construct a proper chain sync checkpoint because Mithril doesn't provide the block hash for that slot.</p> <p>The Problem:</p> <ul> <li>Chain sync requires <code>Point(slot, blockHash)</code> for intersection</li> <li>Mithril provides only the slot number, not the block hash</li> <li>Without a valid Point, we must intersect at Origin</li> </ul> <p>The Solution: Skip Mode</p> <p>Instead of replaying all blocks from genesis (which would be slow and redundant), we use \"skip mode\":</p> <ol> <li>Intersect at Origin - Start chain sync from genesis</li> <li>Skip block fetching - Receive headers but don't fetch/process blocks</li> <li>Track target slot - The Mithril snapshot slot is the target</li> <li>Save checkpoint on arrival - When we reach the target slot, we have the block hash</li> <li>Resume normal sync - Continue with block fetching from that point</li> </ol> <pre><code>Genesis \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Mithril Slot \u2500\u2500\u2500\u2500 Tip\n   \u2502                                                   \u2502            \u2502\n   \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Skip Mode (headers only) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502            \u2502\n   \u2502              No block fetching                    \u2502            \u2502\n   \u2502                                                   \u2502\u25c0\u2500\u2500 Normal \u2500\u25b6\u2502\n   \u2502                                                   \u2502   Sync      \u2502\n</code></pre> <p>During skip mode: - Headers are received from the node at ~15,000-20,000 slots/second - Blocks are NOT fetched or processed - Progress is shown via <code>headerSyncProgress</code> - The database remains unchanged (already has Mithril UTxOs)</p>"},{"location":"mithril-bootstrap/#checkpoint-management","title":"Checkpoint Management","text":"<p>The base checkpoint tracks where chain sync should resume after restart:</p> State Checkpoint Behavior Fresh database None Start Mithril bootstrap After Mithril import Origin Start skip mode from genesis After skip mode completes <code>Point(mithrilSlot, blockHash)</code> Resume normal sync During normal operation Updated periodically Resume from last saved point <p>Current Limitation: If the service restarts during skip mode (after Mithril import but before reaching the target slot), the skip mode state is lost. See issue #76.</p>"},{"location":"mithril-bootstrap/#database-state-during-bootstrap","title":"Database State During Bootstrap","text":"Phase Database Contents Queryable? Downloading Empty No Extracting Partially populated No Syncing Headers Complete Mithril UTxOs Yes (but <code>/ready</code> returns false) Synced Up-to-date UTxOs Yes"},{"location":"mithril-bootstrap/#interrupted-bootstrap-recovery","title":"Interrupted Bootstrap Recovery","text":"<p>If the process is terminated during bootstrap (e.g., during UTxO extraction), partial data may remain in the database. On restart, the service detects this and automatically recovers:</p> <ol> <li>Detection: A bootstrap-in-progress marker is set before streaming UTxOs</li> <li>On restart: If the marker exists, incomplete bootstrap is detected</li> <li>Cleanup: All database tables are wiped (including partial UTxO data)</li> <li>Retry: Bootstrap restarts from the beginning</li> </ol> <p>You'll see these log messages when recovery occurs:</p> <pre><code>Incomplete bootstrap detected, cleaning up partial data...\nArmageddon cleanup started.\nArmageddon cleanup completed.\nIncomplete bootstrap cleanup completed, retrying bootstrap...\n</code></pre> <p>This ensures the database is never left in an inconsistent state after an interruption.</p> <p>The <code>/ready</code> endpoint returns <code>ready: true</code> only when: - <code>bootstrapPhase</code> is <code>synced</code> - <code>chainTipSlot - processedSlot &lt;= syncThreshold</code> (default: 100 slots)</p>"},{"location":"mithril-bootstrap/#api-availability-during-bootstrap","title":"API Availability During Bootstrap","text":"Endpoint Downloading Extracting Syncing Headers Synced <code>/metrics</code> \u2705 \u2705 \u2705 \u2705 <code>/ready</code> \u2705 (false) \u2705 (false) \u2705 (false) \u2705 (true) <code>/merkle-roots</code> \u274c 503 \u274c 503 \u274c 503 \u2705 <code>/proof/{txId}/{txIx}</code> \u274c 503 \u274c 503 \u274c 503 \u2705 <p>Data endpoints return 503 Service Unavailable until the service is fully synced.</p>"},{"location":"mithril-bootstrap/#monitoring-bootstrap-progress","title":"Monitoring Bootstrap Progress","text":"<p>Use the <code>/metrics</code> endpoint to monitor progress:</p> <pre><code># Check current phase\ncurl -s http://localhost:8081/metrics | jq '.bootstrapPhase'\n\n# During extraction\ncurl -s http://localhost:8081/metrics | jq '.extractionProgress'\n# {\"current\": 1500000, \"total\": 2900000, \"percent\": 51.7, \"rate\": 850.5, \"eta\": 1647.2}\n\n# During header sync\ncurl -s http://localhost:8081/metrics | jq '.headerSyncProgress'\n# {\"currentSlot\": 50000000, \"targetSlot\": 103000000}\n\n# Check if ready\ncurl -s http://localhost:8081/ready | jq '.ready'\n</code></pre>"},{"location":"mithril-bootstrap/#how-it-works","title":"How It Works","text":""},{"location":"mithril-bootstrap/#1-fetch-snapshot-metadata","title":"1. Fetch Snapshot Metadata","text":"<p>The client queries the Mithril aggregator API for the latest snapshot:</p> <pre><code>curl -s \"https://aggregator.pre-release-preview.api.mithril.network/aggregator/artifact/snapshots\" | jq \".[0]\"\n</code></pre> <p>Response includes: - <code>digest</code>: Unique snapshot identifier - <code>beacon</code>: Slot and epoch information - <code>locations</code>: Download URLs for immutable files - <code>ancillary_locations</code>: Download URLs for ledger state</p>"},{"location":"mithril-bootstrap/#2-download-and-verify","title":"2. Download and Verify","text":"<p>HTTP Download with Ed25519 Verification</p> <ul> <li>Downloads ancillary archive directly from CDN URLs</li> <li>Verifies <code>ancillary_manifest.json</code> Ed25519 signature</li> <li>Verifies SHA256 hash of each file against manifest</li> <li>Fast, no external dependencies</li> </ul> <p>The ancillary archive contains a signed manifest (<code>ancillary_manifest.json</code>) that lists all files with their SHA256 hashes, plus an Ed25519 signature over the manifest data. Verification ensures:</p> <ol> <li>The manifest signature is valid (signed by IOG's ancillary key)</li> <li>Each extracted file matches its declared hash</li> </ol> <p>Note: Ed25519 verification protects the ancillary files (ledger state). Full STM certificate chain verification is still planned for the immutable files. See STM verification plan for details.</p>"},{"location":"mithril-bootstrap/#3-ledger-state-format","title":"3. Ledger State Format","text":"<p>The snapshot contains ledger state in the UTxO-HD format:</p> <pre><code>ledger/\n\u251c\u2500\u2500 102673454/\n\u2502   \u251c\u2500\u2500 meta\n\u2502   \u251c\u2500\u2500 state\n\u2502   \u2514\u2500\u2500 tables/\n\u2502       \u2514\u2500\u2500 tvar\n\u2514\u2500\u2500 102672637/\n    \u251c\u2500\u2500 meta\n    \u251c\u2500\u2500 state\n    \u2514\u2500\u2500 tables/\n        \u2514\u2500\u2500 tvar\n</code></pre> <p>Each directory is named by slot number and contains the serialized ledger state.</p>"},{"location":"mithril-bootstrap/#4-utxo-extraction","title":"4. UTxO Extraction","text":"<p>The UTxO set is stored in the <code>tables/tvar</code> file within the ledger state directory. This file uses the InMemory backing store format:</p> <pre><code>tvar file format:\n\u251c\u2500\u2500 List[1] - wrapper\n\u2514\u2500\u2500 Map (indefinite-length CBOR)\n    \u251c\u2500\u2500 (bytes: TxIn, bytes: TxOut)\n    \u251c\u2500\u2500 (bytes: TxIn, bytes: TxOut)\n    \u2514\u2500\u2500 ...\n</code></pre> <p>Each key-value pair contains MemPack-encoded <code>TxIn</code> and <code>TxOut</code> (stored as CBOR bytes in the map). The extraction streams these pairs without full ledger state decoding, making it memory-efficient for large UTxO sets (preview: ~560MB, mainnet: much larger).</p>"},{"location":"mithril-bootstrap/#5-stream-processing","title":"5. Stream Processing","text":"<p>The extraction yields a stream of <code>(ByteString, ByteString)</code> pairs:</p> <ul> <li>Key: MemPack-encoded <code>TxIn</code> (decodable via <code>Data.MemPack.unpack</code>)</li> <li>Value: MemPack-encoded <code>TxOut</code> (decodable via <code>Data.MemPack.unpack</code>)</li> </ul> <p>The E2E test verifies that extracted bytes decode successfully as Conway-era <code>Cardano.Ledger.TxIn.TxIn</code> and <code>Cardano.Ledger.Babbage.TxOut.BabbageTxOut</code>.</p> <p>Progress is reported every 10,000 entries during extraction.</p>"},{"location":"mithril-bootstrap/#6-chain-sync-continuation","title":"6. Chain Sync Continuation","text":"<p>Warning: The current implementation replays from genesis after Mithril import. This negates most of the bootstrap speed benefit. See issue #32 for the fix.</p> <p>After importing the UTxO set, chain sync needs to continue from where the snapshot left off. This requires a <code>Point(slot, block_hash)</code>.</p> <p>The Problem:</p> <ul> <li>Mithril provides the slot number (from ledger state directory name)</li> <li>Mithril does not provide the block hash</li> <li>Without the hash, we cannot construct a valid <code>Point</code></li> </ul> <p>Current Behavior:</p> <p>The base checkpoint is set to <code>Origin</code>, causing chain sync to replay from genesis. This works correctly (CSMT operations are idempotent) but is slow.</p> <p>Planned Fix (Issue #32):</p> <p>After Mithril import, perform a header-only chain sync scan:</p> <ol> <li>Connect to node, find intersection at Origin</li> <li>Scan headers until reaching the Mithril slot</li> <li>Extract block hash from that header</li> <li>Save <code>Point(slot, hash)</code> as checkpoint</li> <li>Disconnect and reconnect with proper checkpoint</li> </ol> <p>This adds a few seconds of header scanning but avoids replaying all blocks.</p>"},{"location":"mithril-bootstrap/#alternative-direct-chain-sync","title":"Alternative: Direct Chain Sync","text":"<p>For environments where Mithril is not available or not desired, a direct chain sync approach is planned that syncs the UTxO set from the node without external dependencies.</p> <p>See issue #58 for details and architecture for the data flow.</p> <p>Planned optimizations:</p> <ol> <li> <p>Era projection: Project all TxOut to Conway era before storage, simplifying    era handling with a unified representation</p> </li> <li> <p>Change reduction: Buffer UTxO changes in an intermediate database and reduce    them before loading into the CSMT. This eliminates transient UTxOs (created and    consumed during sync) from ever touching the CSMT</p> </li> </ol> <p>These optimizations should significantly reduce the work needed to build the initial CSMT compared to naive block-by-block replay.</p>"},{"location":"mithril-bootstrap/#security-considerations","title":"Security Considerations","text":""},{"location":"mithril-bootstrap/#ed25519-ancillary-verification-implemented","title":"Ed25519 Ancillary Verification (Implemented)","text":"<p>Ancillary files (ledger state) are protected by Ed25519 signature verification:</p> <ul> <li>Manifest signature: The <code>ancillary_manifest.json</code> is signed by IOG's Ed25519 key</li> <li>File integrity: Each file's SHA256 hash is verified against the manifest</li> <li>Environment variables: Verification keys are read from <code>MITHRIL_ANCILLARY_VERIFICATION_KEY</code></li> </ul> <p>This verification runs automatically when <code>MITHRIL_ANCILLARY_VERIFICATION_KEY</code> is set. To skip it (not recommended):</p> <pre><code>cardano-utxo \\\n    --mithril-bootstrap \\\n    --mithril-skip-ancillary-verification \\\n    ...\n</code></pre> <p>To use a custom verification key via CLI:</p> <pre><code>cardano-utxo \\\n    --mithril-bootstrap \\\n    --mithril-ancillary-verification-key \"5b32332c37312c...\" \\\n    ...\n</code></pre>"},{"location":"mithril-bootstrap/#stm-certificate-chain-planned","title":"STM Certificate Chain (Planned)","text":"<p>Full STM certificate chain verification for immutable files is planned. This will verify that snapshots are correctly signed by Cardano stake pool operators.</p> <p>See the Mithril STM FFI plan for the implementation roadmap.</p>"},{"location":"mithril-bootstrap/#troubleshooting","title":"Troubleshooting","text":""},{"location":"mithril-bootstrap/#snapshot-download-fails","title":"Snapshot Download Fails","text":"<p>Check network connectivity to the aggregator: <pre><code>curl -I \"https://aggregator.pre-release-preview.api.mithril.network/aggregator/artifact/snapshots\"\n</code></pre></p>"},{"location":"mithril-bootstrap/#ledger-state-not-found","title":"Ledger State Not Found","text":"<p>Ensure <code>--include-ancillary</code> is used (automatic in this implementation). The ledger state is in the ancillary data, not the main snapshot.</p>"},{"location":"mithril-bootstrap/#large-download-size","title":"Large Download Size","text":"<p>Preview network ancillary data is ~400MB (tvar file ~560MB after extraction). Mainnet is significantly larger. Ensure sufficient disk space and bandwidth.</p>"},{"location":"mithril-bootstrap/#extraction-errors","title":"Extraction Errors","text":"<p>If extraction fails with \"TablesNotFound\": - Verify the ledger state directory contains <code>tables/tvar</code> - Ensure the download completed successfully</p> <p>If extraction fails with \"TablesDecodeFailed\": - The tvar file format may have changed - Check for updates to ouroboros-consensus</p>"},{"location":"mithril-bootstrap/#bootstrap-interrupted","title":"Bootstrap Interrupted","text":"<p>If the process was killed during bootstrap and you see \"Incomplete bootstrap detected\" on restart, this is normal behavior. The service will:</p> <ol> <li>Clean up partial data from the previous attempt</li> <li>Automatically retry the bootstrap from scratch</li> </ol> <p>No manual intervention is required.</p>"},{"location":"swagger-ui/","title":"Swagger UI","text":""},{"location":"swagger/","title":"Swagger","text":"<pre><code>{\n    \"definitions\": {\n        \"BootstrapPhase\": {\n            \"description\": \"Current bootstrap phase: downloading, counting, extracting, syncing_headers, rolling_back, or synced\",\n            \"enum\": [\n                \"downloading\",\n                \"counting\",\n                \"extracting\",\n                \"syncing_headers\",\n                \"rolling_back\",\n                \"synced\"\n            ],\n            \"type\": \"string\"\n        },\n        \"ExtractionProgress\": {\n            \"description\": \"Progress of UTxO extraction from Mithril snapshot\",\n            \"properties\": {\n                \"current\": {\n                    \"format\": \"int64\",\n                    \"maximum\": 1.8446744073709551615e19,\n                    \"minimum\": 0,\n                    \"type\": \"integer\"\n                },\n                \"eta\": {\n                    \"format\": \"double\",\n                    \"type\": \"number\"\n                },\n                \"percent\": {\n                    \"format\": \"double\",\n                    \"type\": \"number\"\n                },\n                \"rate\": {\n                    \"format\": \"double\",\n                    \"type\": \"number\"\n                },\n                \"total\": {\n                    \"format\": \"int64\",\n                    \"maximum\": 1.8446744073709551615e19,\n                    \"minimum\": 0,\n                    \"type\": \"integer\"\n                }\n            },\n            \"required\": [\n                \"current\",\n                \"rate\"\n            ],\n            \"type\": \"object\"\n        },\n        \"HeaderSyncProgress\": {\n            \"description\": \"Progress of header synchronization after Mithril import\",\n            \"properties\": {\n                \"currentSlot\": {\n                    \"format\": \"int64\",\n                    \"maximum\": 1.8446744073709551615e19,\n                    \"minimum\": 0,\n                    \"type\": \"integer\"\n                },\n                \"targetSlot\": {\n                    \"format\": \"int64\",\n                    \"maximum\": 1.8446744073709551615e19,\n                    \"minimum\": 0,\n                    \"type\": \"integer\"\n                }\n            },\n            \"required\": [\n                \"currentSlot\",\n                \"targetSlot\"\n            ],\n            \"type\": \"object\"\n        },\n        \"InclusionProofResponse\": {\n            \"description\": \"Current inclusion proof and output for the given transaction input.\",\n            \"properties\": {\n                \"merkleRoot\": {\n                    \"type\": \"string\"\n                },\n                \"proof\": {\n                    \"type\": \"string\"\n                },\n                \"txId\": {\n                    \"type\": \"string\"\n                },\n                \"txIx\": {\n                    \"maximum\": 65535,\n                    \"minimum\": 0,\n                    \"type\": \"integer\"\n                },\n                \"txOut\": {\n                    \"type\": \"string\"\n                }\n            },\n            \"required\": [\n                \"txId\",\n                \"txIx\",\n                \"txOut\",\n                \"proof\"\n            ],\n            \"type\": \"object\"\n        },\n        \"MerkleRootEntry\": {\n            \"description\": \"A merkle root entry at a given slot\",\n            \"properties\": {\n                \"blockHash\": {\n                    \"type\": \"string\"\n                },\n                \"merkleRoot\": {\n                    \"type\": \"string\"\n                },\n                \"slotNo\": {\n                    \"maximum\": 1.8446744073709551615e19,\n                    \"minimum\": 0,\n                    \"type\": \"integer\"\n                }\n            },\n            \"required\": [\n                \"slotNo\",\n                \"blockHash\",\n                \"merkleRoot\"\n            ],\n            \"type\": \"object\"\n        },\n        \"Metrics\": {\n            \"description\": \"Metrics about CSMT operations and blockchain synchronization\",\n            \"properties\": {\n                \"averageQueueLength\": {\n                    \"format\": \"double\",\n                    \"type\": \"number\"\n                },\n                \"baseCheckpoint\": {\n                    \"type\": \"string\"\n                },\n                \"blockSpeed\": {\n                    \"format\": \"double\",\n                    \"type\": \"number\"\n                },\n                \"bootstrapPhase\": {\n                    \"$ref\": \"#/definitions/BootstrapPhase\"\n                },\n                \"chainTipSlot\": {\n                    \"format\": \"int64\",\n                    \"maximum\": 1.8446744073709551615e19,\n                    \"minimum\": 0,\n                    \"type\": \"integer\"\n                },\n                \"countingProgress\": {\n                    \"format\": \"int64\",\n                    \"maximum\": 1.8446744073709551615e19,\n                    \"minimum\": 0,\n                    \"type\": \"integer\"\n                },\n                \"currentEra\": {\n                    \"type\": \"string\"\n                },\n                \"currentMerkleRoot\": {\n                    \"type\": \"string\"\n                },\n                \"downloadedBytes\": {\n                    \"format\": \"int64\",\n                    \"maximum\": 1.8446744073709551615e19,\n                    \"minimum\": 0,\n                    \"type\": \"integer\"\n                },\n                \"extractionProgress\": {\n                    \"$ref\": \"#/definitions/ExtractionProgress\"\n                },\n                \"headerSyncProgress\": {\n                    \"$ref\": \"#/definitions/HeaderSyncProgress\"\n                },\n                \"lastBlockPoint\": {\n                    \"type\": \"string\"\n                },\n                \"maxQueueLength\": {\n                    \"maximum\": 9223372036854775807,\n                    \"minimum\": -9223372036854775808,\n                    \"type\": \"integer\"\n                },\n                \"utxoChangesCount\": {\n                    \"maximum\": 9223372036854775807,\n                    \"minimum\": -9223372036854775808,\n                    \"type\": \"integer\"\n                },\n                \"utxoSpeed\": {\n                    \"format\": \"double\",\n                    \"type\": \"number\"\n                }\n            },\n            \"required\": [\n                \"averageQueueLength\",\n                \"maxQueueLength\",\n                \"utxoChangesCount\",\n                \"lastBlockPoint\",\n                \"utxoSpeed\",\n                \"blockSpeed\",\n                \"currentEra\",\n                \"currentMerkleRoot\",\n                \"baseCheckpoint\",\n                \"chainTipSlot\",\n                \"bootstrapPhase\",\n                \"extractionProgress\",\n                \"headerSyncProgress\",\n                \"downloadedBytes\",\n                \"countingProgress\"\n            ],\n            \"type\": \"object\"\n        },\n        \"ReadyResponse\": {\n            \"description\": \"Sync readiness status for orchestration\",\n            \"properties\": {\n                \"processedSlot\": {\n                    \"format\": \"int64\",\n                    \"maximum\": 1.8446744073709551615e19,\n                    \"minimum\": 0,\n                    \"type\": \"integer\"\n                },\n                \"ready\": {\n                    \"type\": \"boolean\"\n                },\n                \"slotsBehind\": {\n                    \"format\": \"int64\",\n                    \"maximum\": 1.8446744073709551615e19,\n                    \"minimum\": 0,\n                    \"type\": \"integer\"\n                },\n                \"tipSlot\": {\n                    \"format\": \"int64\",\n                    \"maximum\": 1.8446744073709551615e19,\n                    \"minimum\": 0,\n                    \"type\": \"integer\"\n                }\n            },\n            \"required\": [\n                \"ready\",\n                \"tipSlot\",\n                \"processedSlot\",\n                \"slotsBehind\"\n            ],\n            \"type\": \"object\"\n        },\n        \"UTxOByAddressEntry\": {\n            \"description\": \"A UTxO entry with CBOR-encoded TxIn and TxOut in base16\",\n            \"properties\": {\n                \"txIn\": {\n                    \"type\": \"string\"\n                },\n                \"txOut\": {\n                    \"type\": \"string\"\n                }\n            },\n            \"required\": [\n                \"txIn\",\n                \"txOut\"\n            ],\n            \"type\": \"object\"\n        }\n    },\n    \"info\": {\n        \"description\": \"An HTTP service that exposes a Compact Sparse Merkle Tree (CSMT) data structure over the current UTxO set of the Cardano blockchain. This API provides metrics about the CSMT operations.\",\n        \"license\": {\n            \"name\": \"Apache 2.0\"\n        },\n        \"title\": \"Cardano UTxO CSMT API\",\n        \"version\": \"0.1.0.0\"\n    },\n    \"paths\": {\n        \"/merkle-roots\": {\n            \"get\": {\n                \"produces\": [\n                    \"application/json;charset=utf-8\"\n                ],\n                \"responses\": {\n                    \"200\": {\n                        \"description\": \"\",\n                        \"schema\": {\n                            \"items\": {\n                                \"$ref\": \"#/definitions/MerkleRootEntry\"\n                            },\n                            \"type\": \"array\"\n                        }\n                    }\n                }\n            }\n        },\n        \"/metrics\": {\n            \"get\": {\n                \"produces\": [\n                    \"application/json;charset=utf-8\"\n                ],\n                \"responses\": {\n                    \"200\": {\n                        \"description\": \"\",\n                        \"schema\": {\n                            \"$ref\": \"#/definitions/Metrics\"\n                        }\n                    }\n                }\n            }\n        },\n        \"/proof/{txId}/{txIx}\": {\n            \"get\": {\n                \"parameters\": [\n                    {\n                        \"in\": \"path\",\n                        \"name\": \"txId\",\n                        \"required\": true,\n                        \"type\": \"string\"\n                    },\n                    {\n                        \"in\": \"path\",\n                        \"maximum\": 65535,\n                        \"minimum\": 0,\n                        \"name\": \"txIx\",\n                        \"required\": true,\n                        \"type\": \"integer\"\n                    }\n                ],\n                \"produces\": [\n                    \"application/json;charset=utf-8\"\n                ],\n                \"responses\": {\n                    \"200\": {\n                        \"description\": \"\",\n                        \"schema\": {\n                            \"$ref\": \"#/definitions/InclusionProofResponse\"\n                        }\n                    },\n                    \"400\": {\n                        \"description\": \"Invalid `txIx` or `txId`\"\n                    }\n                }\n            }\n        },\n        \"/ready\": {\n            \"get\": {\n                \"produces\": [\n                    \"application/json;charset=utf-8\"\n                ],\n                \"responses\": {\n                    \"200\": {\n                        \"description\": \"\",\n                        \"schema\": {\n                            \"$ref\": \"#/definitions/ReadyResponse\"\n                        }\n                    }\n                }\n            }\n        },\n        \"/utxos-by-address/{address}\": {\n            \"get\": {\n                \"parameters\": [\n                    {\n                        \"in\": \"path\",\n                        \"name\": \"address\",\n                        \"required\": true,\n                        \"type\": \"string\"\n                    }\n                ],\n                \"produces\": [\n                    \"application/json;charset=utf-8\"\n                ],\n                \"responses\": {\n                    \"200\": {\n                        \"description\": \"\",\n                        \"schema\": {\n                            \"items\": {\n                                \"$ref\": \"#/definitions/UTxOByAddressEntry\"\n                            },\n                            \"type\": \"array\"\n                        }\n                    },\n                    \"400\": {\n                        \"description\": \"Invalid `address`\"\n                    }\n                }\n            }\n        }\n    },\n    \"swagger\": \"2.0\"\n}\n</code></pre>"},{"location":"presentation/light-clients/","title":"Poor Man's Light Clients for Cardano","text":""},{"location":"presentation/light-clients/#trust-minimized-blockchain-access-via-merkle-proofs","title":"Trust-minimized blockchain access via Merkle proofs","text":""},{"location":"presentation/light-clients/#the-challenge-full-nodes-are-heavy","title":"The Challenge: Full Nodes Are Heavy","text":"<p>Today's Reality</p> <ul> <li>Running a Cardano full node requires ~300GB of storage</li> <li>High memory requirements</li> <li>Constant network availability and bandwidth</li> </ul> <p>Tomorrow's Reality</p> <ul> <li>Storage requirements will only grow</li> <li>Hardware requirements will rise with new features</li> <li>Amaru will help a bit, but not enough</li> </ul> <p>This kills participation</p>"},{"location":"presentation/light-clients/#why-does-this-matter","title":"Why Does This Matter?","text":"<p>Decentralization depends on accessibility</p> <ul> <li>Mobile wallets can't run full nodes</li> <li>Browsers can't run full nodes</li> <li>IoT devices can't run full nodes</li> <li>Developing countries face infrastructure barriers</li> </ul> <p>Result: Most users depend on centralized services for blockchain data and transaction building.</p>"},{"location":"presentation/light-clients/#the-trust-problem","title":"The Trust Problem","text":"<p>Application servers provide blockchain data and unsigned transactions for users to interact with the network.</p> <ul> <li>Without a full node, users must trust the server</li> <li>Trusting a centralized server undermines decentralization</li> <li>Even honest servers bring risks: hackers can compromise them</li> <li>Users have no way to verify data integrity</li> </ul> <p>Current Light Client Options</p> Approach Trust Required Centralized API Trust the provider completely Full node Trust no one (but heavy) <p>We need a middle ground</p>"},{"location":"presentation/light-clients/#we-can-prove-an-untrusted-server-is-honest","title":"We Can Prove an Untrusted Server Is Honest","text":"<p>Cryptographic Proofs Remove Trust Assumptions from servers of web3 applications.</p> <p>If untrusted servers provide proofs that clients can verify independently, we remove the need to trust them: - Good for the server: they're protected even if hacked or compromised - Good for the client: they trust math, not promises - Good for trusted parties: they build reputation without involvement in specific applications</p>"},{"location":"presentation/light-clients/#the-solution-merkle-trees","title":"The Solution: Merkle Trees","text":"<p>A Fingerprint for the Entire UTxO Set</p> <pre><code>        Root Hash (32 bytes)\n       /                    \\\n    Hash                    Hash\n   /    \\                  /    \\\n UTxO  UTxO              UTxO  UTxO\n</code></pre> <ul> <li>A single root hash represents millions of UTxOs</li> <li>Anyone can verify that a UTxO belongs to the set</li> <li>Changing any UTxO changes the root</li> </ul>"},{"location":"presentation/light-clients/#the-simplest-possible-infrastructure","title":"The Simplest Possible Infrastructure","text":"<p>Publishing a Merkle root is trivial</p> <p>A JSON file with UTxO set root hashes covering the rollback window, updated every block (~20 seconds):</p> <pre><code>[\n  { \"slot\": 123456789, \"root\": \"a1b2c3...\" },\n  { \"slot\": 123456769, \"root\": \"d4e5f6...\" },\n  { \"slot\": 123456749, \"root\": \"g7h8i9...\" },\n  ...\n]\n</code></pre> <p>Can be hosted anywhere: - GitHub release asset - Google Drive - S3 bucket - Even a tweet/X post</p>"},{"location":"presentation/light-clients/#poor-mans-multisignature","title":"Poor Man's Multisignature","text":"<p>Multiple independent publishers = distributed trust</p> <p>Light clients sample 2-3 sources: match \u2192 verified | differ \u2192 investigate</p>"},{"location":"presentation/light-clients/#who-should-publish","title":"Who Should Publish?","text":"<p>Institutions (low effort, high impact)</p> Publisher Why Cardano Foundation Ecosystem steward IOG Core developers Emurgo Enterprise adoption Mithril team Already running infra <p>Anyone else</p> <ul> <li>Stake pool operators</li> <li>Exchanges</li> <li>dApp developers</li> <li>Community members</li> <li>Any company using Cardano for business operations</li> </ul> <p>More publishers = stronger decentralization</p>"},{"location":"presentation/light-clients/#the-architecture","title":"The Architecture","text":""},{"location":"presentation/light-clients/#benefits-summary","title":"Benefits Summary","text":"Stakeholder Benefit End Users Fast, verifiable access to dApps Developers Simple API, no node required, just proof verification libraries Ecosystem More decentralized infrastructure Publishers Low effort, high impact reputation boost"},{"location":"presentation/light-clients/#cost-to-participate","title":"Cost to Participate","text":"Role Infrastructure Interface Root Publisher Node + cardano-utxo-csmt Static file hosting (GitHub, S3, etc.) Application Server Node + cardano-utxo-csmt Patch API to serve proofs with data Light Client None Proof verification library (browser/mobile) <p>Publishing roots costs almost nothing</p>"},{"location":"presentation/light-clients/#current-status","title":"Current Status","text":"<p>Working Today</p> <ul> <li>\u2705 Merkle tree construction from UTxO set</li> <li>\u2705 Proof generation and verification</li> <li>\u2705 HTTP API for light clients</li> <li>\u2705 Fast bootstrap via Mithril</li> <li>\u2705 Real-time chain sync</li> </ul> <p>Next Steps</p> <ul> <li>Integration with wallet SDKs</li> <li>Public testnet deployment</li> <li>Performance optimization</li> </ul>"},{"location":"presentation/light-clients/#the-vision","title":"The Vision","text":"<p>A Cardano where:</p> <ul> <li>Application servers don't bear the burden of trust</li> <li>Light clients choose their trusted publishers from multiple independent institutions</li> </ul>"},{"location":"presentation/light-clients/#questions","title":"Questions?","text":"<p>Resources</p> <ul> <li>GitHub: <code>paolino/cardano-utxo-csmt</code></li> <li>Documentation: <code>/docs</code></li> </ul>"},{"location":"presentation/slides/","title":"Light Clients Presentation","text":"<p>Controls: Arrow keys / Space (navigate) | F (fullscreen) | Esc (overview)</p> <p>Open fullscreen presentation</p>"}]}